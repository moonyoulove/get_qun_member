<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="RocketCake">
	<title></title>
	<style type="text/css">
		a { color:#5D5D9E; } 
		a:visited { color:#5D5D9E; } 
		a:active { color:#5C615E; } 
		a:hover { color:#B2B3B4; } 
	</style>
</head>
<body style="background-color:#FFFFFF; padding:0;  margin: 0;">
<div style="text-align:center;">
  <div style="vertical-align: top; position:relative; display: inline-block; width:23%; min-height:318px; background:none; " id="container_1789df23">
    <div style="margin: 10px; display: block; " id="container_1789df23_padding" >
      <div style="text-align:left;">
<input name="CheckBox1" type="checkbox" value="" title="" checked="checked"  style="vertical-align: bottom; position:relative; display: inline-block; width:20px; height:20px; " id="checkbox_78055da2" >
        <span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">轉換頭像網址<br/></span>
<input name="CheckBox2" type="checkbox" value="" title="" checked="checked"  style="vertical-align: bottom; position:relative; display: inline-block; width:20px; height:20px; " id="checkbox_25bd00f2" >
        <span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">加入專屬頭銜<br/><br/></span>
<textarea name="TextEdit1" title="" cols="19" rows="8"  style="box-sizing: border-box; vertical-align: bottom; position:relative; display: inline-block; width:195px; height:174px; background-color:#FFFFFF; border: 1px solid #A0A0A0; font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; " id="edit_c31bbfd"></textarea>
        <span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> <br/><br/></span>
<input name="Button1" type="button" value="獲取成員" title=""  style="vertical-align: bottom; position:relative; display: inline-block; width:100px; height:30px; font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; " id="button_4aba8bf3" >
        </div>
      <div style="clear:both"></div>
      </div>
    </div>
  </div>
  <script>
	var group = {};
	var qun_url = "https://qun.qq.com/cgi-bin/qun_mgr/search_group_members?st=0&end=1000";
	var bkn = parent.$.getCSRFToken();
	var gc = parent.document.URL.split("#gid=")[1];
	var logo_url = "https://ptlogin2.qq.com/getface?&imgtype=4&uin=";
	var pt = {};
	var logo_left_count = 0;
	var script = {};

	var xhr = new XMLHttpRequest();

	xhr.open("get", `$ {
		qun_url
	} & bkn = $ {
		bkn
	} & gc = $ {
		gc
	}`, true);
	xhr.send();
	xhr.onreadystatechange = function() {
		if (xhr.readyState == 4 && xhr.status == 200) {
			group = JSON.parse(xhr.responseText);
			if (confirm("是否要加入專屬頭銜?")) addSpecialTitle();
			if (confirm("是否要轉換頭像網址?")) {
				convertLogoUrl()
			} else {
				alert(JSON.stringify(group.mems));
			}
		}
	}

	pt.setHeader = function(url_data) {
		script.remove();
		group.mems[logo_left_count].logo = url_data[group.mems[logo_left_count].uin];
		if (logo_left_count > 0) {
			logo_left_count--;
			dialog.innerText = logo_left_count;
			script = document.createElement("script");
			script.src = logo_url + group.mems[logo_left_count].uin;
			document.body.appendChild(script);
		} else {
			dialog.innerText = "完成";
			alert(JSON.stringify(group.mems));
		}
	}

	function addSpecialTitle() {
		group.mems.sort(function(a, b) {
			return a.join_time - b.join_time
		});
		var p = prompt("貼上專屬頭銜的數組", "[{nick:\"muli\",title:\"編程組\"}]");
		if (p == null || p == "") return;
		var st = JSON.parse(p);
		var l = group.mems.length;
		while (l--) {
			group.mems[l].title = st[l].title;
		}
	}
	function convertLogoUrl() {
		logo_left_count = group.mems.length - 1;
		dialog.innerText = logo_left_count;
		document.body.appendChild(dialog);
		script = document.createElement("script");
		script.src = logo_url + group.mems[logo_left_count].uin;
		document.body.appendChild(script);
	}
  </script>
</body>
</html>
